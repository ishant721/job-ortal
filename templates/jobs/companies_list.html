
{% extends "base.html" %}
{% load page_tags %}
{% load searchtags %}
{% load thumbnail %}
{% load static %}
{% block block_canonical_tag %}
{% if current_page|slugify == '1'|slugify %}
{% else %}
<link rel="prev" href="https://peeljobs.com{{ current_url }}{% if prev_page != 1 %}{{ prev_page }}/{% endif %}" />
{% endif %}
{% if current_page <= last_page %}
{% if current_page == last_page %}{% else %}
<link rel="next" href="https://peeljobs.com{{ current_url }}{{current_page| add:"1"}}/" />
{% endif %}{% endif %}
{% endblock %}
{% block block_title %}
  {% include "meta_data/companies_list.html" %}
{% endblock %}
{% block page_search_block %}
  {% show_search_filter %}
{% endblock %}

{% block base %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          primary: '#0060b9',
          accent: '#00aeef',
          secondary: '#62bb46',
          dark: '#45586d',
          light: '#f5f6f7'
        }
      }
    }
  }
</script>

<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
  <!-- Header Section -->
  <div class="bg-white shadow-sm border-b border-gray-200">
    <div class="container mx-auto px-4 py-6">
      <!-- Breadcrumb -->
      <nav class="mb-4" aria-label="breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-gray-600">
          <li>
            <a href="{{ request.scheme }}://{{ request.META.HTTP_HOST }}" class="text-primary hover:text-blue-800 transition-colors">
              <i class="fas fa-home mr-1"></i>Home
            </a>
          </li>
          <li class="flex items-center">
            <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
            <span class="text-gray-500">Companies List</span>
          </li>
        </ol>
      </nav>
      
      <!-- Page Header -->
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2">Top Companies</h1>
          <p class="text-gray-600">Discover leading companies and their job openings</p>
        </div>
        <div class="hidden md:block">
          <div class="bg-gradient-to-r from-primary to-accent text-white px-6 py-3 rounded-lg">
            <div class="text-center">
              <div class="text-2xl font-bold">{{ companies|length }}+</div>
              <div class="text-sm opacity-90">Companies</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Main Content -->
      <div class="flex-1">
        <!-- Alphabet Filter -->
        <form name="companyform" id="companyform" method="post" class="hidden">
          {% csrf_token %}
          <input type="hidden" name="alphabet_value" id="alphabet_value" value="{{request.POST.alphabet_value}}">
          <input type="hidden" name="page" id="page" value="{{request.POST.page}}">
          <button type="submit" style="display:none;"></button>
        </form>

        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Browse by Alphabet</h3>
          <div class="flex flex-wrap gap-2">
            <button class="alphabets-btn px-4 py-2 bg-secondary text-white rounded-lg font-medium hover:bg-green-600 transition-colors">
              All Companies
            </button>
            {% for letter in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' %}
            <button class="alphabets-btn {{ letter|lower }} px-3 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-primary hover:text-white transition-colors">
              {{ letter }}
            </button>
            {% endfor %}
          </div>
        </div>

        <!-- Companies Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          {% for company in companies %}
          <div class="company-card bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group">
            <div class="flex items-start space-x-4">
              <!-- Company Logo -->
              <div class="flex-shrink-0">
                <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center overflow-hidden">
                  {% thumbnail company.get_logo_url "64x64" as im %}
                  <img src="{{ im.url }}" alt="{{ company.name|capfirst}} Logo" class="w-full h-full object-cover rounded-xl">
                  {% endthumbnail %}
                </div>
              </div>
              
              <!-- Company Details -->
              <div class="flex-1 min-w-0">
                <h4 class="text-lg font-semibold text-gray-800 group-hover:text-primary transition-colors mb-2 truncate">
                  <a class="company_url" href="{% url 'company_jobs' company.slug %}" target="_blank" title="{{ company.name|capfirst}}">
                    {{ company.name }}
                  </a>
                </h4>
                
                {% if company.website %}
                <div class="flex items-center text-sm text-gray-600 mb-3">
                  <i class="fas fa-link w-4 h-4 mr-2 text-gray-400"></i>
                  <a rel="nofollow" href="{% if 'http' in company.website %}{{ company.website }}{% else %}http://{{ company.website }}{% endif %}" 
                     target="_blank" class="hover:text-primary transition-colors truncate">
                    {{ company.get_website }}
                  </a>
                </div>
                {% endif %}
                
                <!-- Job Count & Action -->
                <div class="flex items-center justify-between">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    <i class="fas fa-briefcase w-3 h-3 mr-1"></i>
                    View Jobs
                  </span>
                  <i class="fas fa-arrow-right text-gray-400 group-hover:text-primary group-hover:translate-x-1 transition-all"></i>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="flex justify-center">
          <nav aria-label="Page navigation" class="bg-white rounded-lg shadow-sm border border-gray-200 p-2">
            <ul class="flex items-center space-x-1">
              <li>
                <a class="flex items-center justify-center w-10 h-10 text-gray-500 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors" href="#" aria-label="Previous">
                  <i class="fas fa-chevron-left"></i>
                </a>
              </li>
              <li><a class="flex items-center justify-center w-10 h-10 text-white bg-primary rounded-lg font-medium" href="#">1</a></li>
              <li><a class="flex items-center justify-center w-10 h-10 text-gray-700 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors" href="#">2</a></li>
              <li><a class="flex items-center justify-center w-10 h-10 text-gray-700 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors" href="#">3</a></li>
              <li>
                <a class="flex items-center justify-center w-10 h-10 text-gray-500 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors" href="#" aria-label="Next">
                  <i class="fas fa-chevron-right"></i>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="w-full lg:w-80">
        <!-- Upload Resume Card -->
        {% if request.user.is_authenticated %}
          {% if request.user.is_jobseeker and not request.user.resume %}
          <div class="bg-gradient-to-r from-accent to-blue-500 rounded-xl p-6 text-white mb-6">
            <div class="text-center">
              <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-cloud-upload text-2xl"></i>
              </div>
              <h3 class="text-lg font-semibold mb-2">Upload Your Resume</h3>
              <p class="text-sm opacity-90 mb-4">Get discovered by top companies</p>
              <a href="/profile/" class="inline-flex items-center px-4 py-2 bg-white text-accent rounded-lg font-medium hover:bg-gray-100 transition-colors">
                <i class="fas fa-upload mr-2"></i>
                Upload Now
              </a>
            </div>
          </div>
          {% endif %} 
        {% else %}
        <div class="bg-gradient-to-r from-accent to-blue-500 rounded-xl p-6 text-white mb-6">
          <div class="text-center">
            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-cloud-upload text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">Upload Your Resume</h3>
            <p class="text-sm opacity-90 mb-4">Get discovered by top companies</p>
            <a href="#" data-toggle="modal" data-target="#login_register" class="inline-flex items-center px-4 py-2 bg-white text-accent rounded-lg font-medium hover:bg-gray-100 transition-colors">
              <i class="fas fa-upload mr-2"></i>
              Upload Now
            </a>
          </div>
        </div>
        {% endif %}

        <!-- Job Subscription -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Get Job Alerts</h3>
          <p class="text-gray-600 text-sm mb-4">Subscribe to get personalized job alerts in your inbox</p>
          
          <form id="Jobsubscribeform" name="Jobsubscribeform" class="space-y-4" method="POST">
            <div>
              <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" id="job_skills" name="skill" multiple>
                <option value="">Select Skills</option>
              </select>
              <span class="skill_err text-red-500 text-xs"></span>
              <p id="job_response_message" class="text-sm mt-1"></p>
            </div>
            
            <div>
              {% if request.user.email %}
              <input type="hidden" name="email" id="job_email" value="{{ request.user.email }}" />
              {% else %}
              <input type="email" name="email" id="job_email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter Your Email Address" required/>
              {% endif %}
            </div>
            
            <button type="submit" class="w-full bg-secondary text-white py-2 px-4 rounded-lg font-medium hover:bg-green-600 transition-colors">
              Subscribe Now
            </button>
          </form>
        </div>

        <!-- Walk-in Jobs -->
        {% get_latest_walkins as walkins %}
        {% if walkins %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">Walk-in Jobs</h3>
            <a href="{% url 'walkin_jobs' %}" target="_blank" class="text-accent hover:text-blue-600 text-sm font-medium">
              See More <i class="fas fa-arrow-right ml-1"></i>
            </a>
          </div>
          
          <div class="space-y-4">
            {% for walkin in walkins|slice:"5" %}
            <div class="walkin-job border-b border-gray-100 pb-4 last:border-b-0 last:pb-0 cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors" id="{{ walkin.get_absolute_url }}">
              <h4 class="font-medium text-gray-800 mb-1 hover:text-primary transition-colors">
                <a href="{{ walkin.get_absolute_url }}" target="_blank">{{ walkin.title }}</a>
              </h4>
              {% if walkin.company %}
              <p class="text-sm text-gray-600 mb-2">{{ walkin.company.name }}</p>
              {% endif %}
              <div class="flex items-center text-xs text-gray-500">
                <i class="fas fa-map-marker-alt mr-1"></i>
                {% for location in walkin.location.all %}
                  {% if location.status == 'Enabled' %}
                    <a href="{{location.get_job_url}}" target="_blank" class="hover:text-primary">{{ location.name }}</a>
                  {% else %}
                    <span>{{ location.name }}</span>
                  {% endif %}
                  {% if not forloop.last %}, {% endif %}
                {% endfor %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
.company-card:hover {
  transform: translateY(-2px);
}

.alphabets-btn.active {
  background-color: #0060b9 !important;
  color: white !important;
}
</style>

<script>
$(document).ready(function() {
  // Company card click handler
  $('.company-card').click(function(e){
    e.preventDefault();
    window.open($(this).find(".company_url").attr("href"), '_blank');
  });
  
  // Prevent link clicks from triggering card click
  $(".company-card a").click(function(e){
    e.stopPropagation();
  });

  // Alphabet filter
  $('.alphabets-btn').click(function(e){
    e.preventDefault();
    $('.alphabets-btn').removeClass('active');
    $(this).addClass('active');
    
    $('#page').val(1);
    $('#alphabet_value').val($(this).attr('class').split(' ').pop());
    $('#companyform').submit();
  });

  // Pagination
  $('.pagination a').click(function(e) {
    e.preventDefault();
    $('#page').val($(this).data('page') || 1);
    let url = '/companies/';
    if ($(this).data('page') && $(this).data('page') != 1) {
      url = '/companies/' + $(this).data('page') + '/';
    }
    $('#companyform').attr('action', url);
    $('#companyform').submit();
  });

  // Set active alphabet
  function setActiveAlphabet(){
    var cl = $("#alphabet_value").val();
    if (cl){
      $("." + cl).addClass('active');
    }
  }
  setActiveAlphabet();

  // Load skills for subscription
  $('#job_skills').empty();
  $('#job_skills').append(new Option('Select a Skill', ''));
  $.getJSON("{% url 'jobs:get_skills' %}", function (data) {
    $.each(JSON.parse(data.response), function (key, field) {
      $('#job_skills').append(new Option(field.fields.name, field.pk));
    });
  });

  // Walk-in job click handler
  $('.walkin-job').click(function(){
    window.open($(this).attr('id'), '_blank');
  });
});
</script>
{% endblock %}
