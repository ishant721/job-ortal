{% extends "base_with_tailwind.html" %}
{% load page_tags %}
{% load cache %}
{% load searchtags %}
{% load thumbnail %}

{% block block_canonical %}
<link rel="canonical" href="https://morgan.com{{ request.path }}"/>
{% endblock %}

{% block block_title %}
  {% include 'meta_data/jobs_list_data.html' %}
{% endblock %}

{% block page_search_block %}
{% show_search_filter %}
{% endblock %}

{% block base %}
<div class="min-h-screen" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
  <!-- Hero Section -->
  <div class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800 opacity-90"></div>
    <div class="relative container mx-auto px-4 py-16">
      <div class="text-center text-white">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">
          {% if searched_job_type == 'walk-in' %}
            Walk-in Job Opportunities
          {% else %}
            Latest Job Opportunities
          {% endif %}
        </h1>
        <p class="text-xl text-blue-100 mb-6">Discover your next career opportunity</p>
        <div class="flex justify-center items-center space-x-4 text-blue-100">
          <span class="flex items-center">
            <i class="fas fa-briefcase mr-2"></i>
            {{ no_of_jobs }} Active Jobs
          </span>
          {% if searched_job_type == 'walk-in' %}
          <span class="flex items-center">
            <i class="fas fa-calendar-check mr-2"></i>
            Walk-in Interviews Available
          </span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8 relative -mt-8">
    <!-- Search Results Summary -->
    {% if searched_skills or searched_locations or searched_industry or searched_edu %}
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-100">
      <div class="flex flex-wrap items-center gap-4">
        <h3 class="text-lg font-semibold text-gray-800">Applied Filters:</h3>
        {% if searched_skills %}
          {% for skill in searched_skills %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800">
              <i class="fas fa-code mr-1"></i>
              {{ skill.name }}
            </span>
          {% endfor %}
        {% endif %}
        {% if searched_locations %}
          {% for location in searched_locations %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
              <i class="fas fa-map-marker-alt mr-1"></i>
              {{ location.name }}
            </span>
          {% endfor %}
        {% endif %}
        {% if searched_industry %}
          {% for industry in searched_industry %}
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-800">
              <i class="fas fa-building mr-1"></i>
              {{ industry.name }}
            </span>
          {% endfor %}
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Jobs Grid -->
    <div class="grid lg:grid-cols-3 gap-8">
      <!-- Job Listings -->
      <div class="lg:col-span-2 space-y-6">
        {% if job_list %}
          {% for job in job_list %}
            <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 group">
              <!-- Job Header -->
              <div class="p-6 border-b border-gray-50">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <div class="flex items-center space-x-3 mb-3">
                      {% if job.company.company_logo %}
                        <img src="{{ job.company.company_logo.url }}" alt="{{ job.company.name }}" class="w-12 h-12 rounded-lg object-cover border border-gray-200">
                      {% else %}
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg">
                          {{ job.company.name|first }}
                        </div>
                      {% endif %}
                      <div>
                        <h3 class="text-lg font-semibold text-gray-800 group-hover:text-blue-600 transition-colors">
                          <a href="{{ job.get_absolute_url }}" class="hover:underline">{{ job.title }}</a>
                        </h3>
                        <p class="text-gray-600 text-sm">{{ job.company.name }}</p>
                      </div>
                    </div>
                  </div>
                  {% if job.job_type == 'walk-in' %}
                    <div class="flex flex-col items-end">
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-orange-100 to-red-100 text-orange-800 border border-orange-200">
                        <i class="fas fa-walking mr-1"></i>
                        Walk-in Interview
                      </span>
                      {% if job.walkin_from_date %}
                        <span class="text-xs text-gray-500 mt-1">
                          <i class="fas fa-calendar mr-1"></i>
                          {{ job.walkin_from_date|date:"M d, Y" }}
                        </span>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
              </div>

              <!-- Job Details -->
              <div class="p-6">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                  <div class="flex items-center text-sm text-gray-600">
                    <i class="fas fa-map-marker-alt text-green-500 mr-2"></i>
                    <span>{{ job.location.name|default:"Not specified" }}</span>
                  </div>
                  <div class="flex items-center text-sm text-gray-600">
                    <i class="fas fa-user-graduate text-blue-500 mr-2"></i>
                    <span>{{ job.min_experience|default:"Fresher" }} - {{ job.max_experience|default:"Any" }} years</span>
                  </div>
                  {% if job.salary_min or job.salary_max %}
                  <div class="flex items-center text-sm text-gray-600">
                    <i class="fas fa-rupee-sign text-green-500 mr-2"></i>
                    <span>
                      {% if job.salary_min %}₹{{ job.salary_min|floatformat:0 }}{% endif %}
                      {% if job.salary_max %} - ₹{{ job.salary_max|floatformat:0 }}{% endif %}
                    </span>
                  </div>
                  {% endif %}
                  <div class="flex items-center text-sm text-gray-600">
                    <i class="fas fa-clock text-purple-500 mr-2"></i>
                    <span>{{ job.published_date|timesince }} ago</span>
                  </div>
                </div>

                {% if job.skills.all %}
                <div class="mb-4">
                  <div class="flex flex-wrap gap-2">
                    {% for skill in job.skills.all|slice:":5" %}
                      <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-md text-xs hover:bg-blue-100 hover:text-blue-800 transition-colors">
                        {{ skill.name }}
                      </span>
                    {% endfor %}
                    {% if job.skills.all.count > 5 %}
                      <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-md text-xs">
                        +{{ job.skills.all.count|add:"-5" }} more
                      </span>
                    {% endif %}
                  </div>
                </div>
                {% endif %}

                <!-- Job Description Preview -->
                {% if job.description %}
                <div class="mb-4">
                  <p class="text-gray-600 text-sm line-clamp-2">{{ job.description|striptags|truncatewords:30 }}</p>
                </div>
                {% endif %}

                <!-- Walk-in Interview Details -->
                {% if job.job_type == 'walk-in' and job.walkin_contactinfo %}
                <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-4 mb-4 border border-orange-100">
                  <h4 class="font-semibold text-orange-800 mb-2 flex items-center">
                    <i class="fas fa-info-circle mr-2"></i>
                    Walk-in Interview Details
                  </h4>
                  <div class="space-y-2 text-sm">
                    {% if job.walkin_from_date and job.walkin_to_date %}
                    <div class="flex items-center text-gray-700">
                      <i class="fas fa-calendar-alt text-orange-500 mr-2 w-4"></i>
                      <span>{{ job.walkin_from_date|date:"M d" }} to {{ job.walkin_to_date|date:"M d, Y" }}</span>
                    </div>
                    {% endif %}
                    {% if job.walkin_time %}
                    <div class="flex items-center text-gray-700">
                      <i class="fas fa-clock text-orange-500 mr-2 w-4"></i>
                      <span>{{ job.walkin_time }}</span>
                    </div>
                    {% endif %}
                  </div>
                </div>
                {% endif %}

                <!-- Action Buttons -->
                <div class="flex items-center justify-between">
                  <a href="{{ job.get_absolute_url }}" 
                     class="inline-flex items-center px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-eye mr-2"></i>
                    View Details
                  </a>

                  {% if job.job_type == 'walk-in' %}
                    <span class="text-sm font-medium text-orange-600 flex items-center">
                      <i class="fas fa-walking mr-1"></i>
                      Walk-in Available
                    </span>
                  {% else %}
                    <button class="inline-flex items-center px-4 py-2 border border-green-600 text-green-600 font-medium rounded-lg hover:bg-green-50 transition-colors">
                      <i class="fas fa-paper-plane mr-2"></i>
                      Apply Now
                    </button>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}

          <!-- Pagination -->
          {% if last_page > 1 %}
          <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
            <div class="flex justify-center">
              <nav class="flex items-center space-x-2">
                {% if prev_page %}
                  <a href="?page={{ prev_page }}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    Previous
                  </a>
                {% endif %}

                {% for page_num in previous_page %}
                  <a href="?page={{ page_num }}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    {{ page_num }}
                  </a>
                {% endfor %}

                <span class="px-3 py-2 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-purple-600 border border-blue-600 rounded-md">
                  {{ current_page }}
                </span>

                {% for page_num in after_page %}
                  <a href="?page={{ page_num }}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    {{ page_num }}
                  </a>
                {% endfor %}

                {% if aft_page %}
                  <a href="?page={{ aft_page }}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                    Next
                  </a>
                {% endif %}
              </nav>
            </div>
          </div>
          {% endif %}

        {% else %}
          <!-- No Jobs Found -->
          <div class="bg-white rounded-xl shadow-lg p-12 text-center border border-gray-100">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="fas fa-search text-gray-400 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-semibold text-gray-800 mb-4">No Jobs Found</h3>
            <p class="text-gray-600 mb-6">We couldn't find any jobs matching your criteria. Try adjusting your search filters.</p>
            <a href="{% url 'jobs_list' %}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
              <i class="fas fa-search mr-2"></i>
              Browse All Jobs
            </a>
          </div>
        {% endif %}
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Quick Stats -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Stats</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-gray-600">Total Jobs</span>
              <span class="font-semibold text-blue-600">{{ no_of_jobs }}</span>
            </div>
            {% if searched_job_type == 'walk-in' %}
            <div class="flex items-center justify-between">
              <span class="text-gray-600">Walk-in Jobs</span>
              <span class="font-semibold text-orange-600">{{ no_of_jobs }}</span>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Job Alert -->
        <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-100">
          <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-bell text-white text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Never Miss a Job</h3>
            <p class="text-gray-600 text-sm mb-4">Get notified when new jobs matching your preferences are posted.</p>
            <a href="{% url 'alert:job_alert' %}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
              <i class="fas fa-plus mr-2"></i>
              Create Job Alert
            </a>
          </div>
        </div>

        <!-- Featured Companies -->
        <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Top Hiring Companies</h3>
          <div class="space-y-3">
            {% for job in job_list|slice:":5" %}
              <div class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 transition-colors">
                {% if job.company.company_logo %}
                  <img src="{{ job.company.company_logo.url }}" alt="{{ job.company.name }}" class="w-8 h-8 rounded object-cover">
                {% else %}
                  <div class="w-8 h-8 rounded bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold">
                    {{ job.company.name|first }}
                  </div>
                {% endif %}
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-800 truncate">{{ job.company.name }}</p>
                  <p class="text-xs text-gray-500">{{ job.location.name }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>
{% endblock %}